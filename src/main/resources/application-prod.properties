# CORS origins for production
app.cors.allowed-origins=https://oci.prodet.org
storage.location=/app/uploads

# Oracle DB (prod): credentials should come from Vault (injected as env vars)
# You can provide DB creds either:
# - directly as env vars (DB_APP_USER / DB_APP_PASSWORD), OR
# - from OCI Vault via SDK (provide Secret OCIDs; see oci.vault.* below)
#
# Required envs/properties (always):
# - DB_JDBC_URL (javasolt: jdbc:oracle:thin:@<TNS_ALIAS_FROM_TNSNAMES_ORA>?TNS_ADMIN=/app/wallet)
#
# If not using Vault SDK:
# - DB_APP_USER / DB_APP_PASSWORD
#
# If using Vault SDK:
# - OCI_REGION (e.g. eu-frankfurt-1)
# - OCI_SECRET_DB_APP_USER (Secret OCID)
# - OCI_SECRET_DB_APP_PASSWORD (Secret OCID)
spring.datasource.url=${DB_JDBC_URL}
spring.datasource.username=${DB_APP_USER:}
spring.datasource.password=${DB_APP_PASSWORD:}
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver

# Use the schema where Flyway created the tables (typically APP_OWNER), so app_user can access them via grants
# without having to schema-qualify every query (otherwise ORA-00942 on `FROM app_file`).
spring.datasource.hikari.connection-init-sql=ALTER SESSION SET CURRENT_SCHEMA=${spring.flyway.user}

# Flyway (optionally run as schema owner)
spring.flyway.user=${DB_OWNER_USER:${DB_APP_USER:}}
spring.flyway.password=${DB_OWNER_PASSWORD:${DB_APP_PASSWORD:}}

# OCI Vault (Secrets) via SDK â€“ sets spring.datasource.* / spring.flyway.* during bootstrap
oci.vault.enabled=${OCI_VAULT_ENABLED:true}
oci.vault.region=${OCI_REGION:}
oci.vault.auth=${OCI_VAULT_AUTH:instance_principal}
oci.vault.secrets.db-app-user=${OCI_SECRET_DB_APP_USER:}
oci.vault.secrets.db-app-password=${OCI_SECRET_DB_APP_PASSWORD:}
oci.vault.secrets.db-owner-user=${OCI_SECRET_DB_OWNER_USER:}
oci.vault.secrets.db-owner-password=${OCI_SECRET_DB_OWNER_PASSWORD:}

# OAuth2 Client (Keycloak) for browser login redirect (production)
spring.security.oauth2.client.registration.keycloak.client-id=${KEYCLOAK_CLIENT_ID:ociprodet}
spring.security.oauth2.client.registration.keycloak.client-name=Keycloak
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}
# If your client in Keycloak is PUBLIC, keep the next line; if CONFIDENTIAL, change to client_secret_basic and set client-secret.
spring.security.oauth2.client.registration.keycloak.client-authentication-method=${KEYCLOAK_CLIENT_AUTH_METHOD:none}
spring.security.oauth2.client.registration.keycloak.scope=openid,profile,email
spring.security.oauth2.client.registration.keycloak.provider=keycloak

spring.security.oauth2.client.provider.keycloak.issuer-uri=https://kc.prodet.org/realms/ociprodet

# Flyway placeholder (Oracle role/user to grant table privileges to)
spring.flyway.placeholders.appUser=${DB_APP_USER:APP_USER}

# Actuator (prod): minimal surface. All endpoints still require auth via SecurityConfig.
management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never
management.endpoint.health.show-components=never

# Example prod overrides (extend as needed)
# spring.security.oauth2.client.registration.keycloak.client-authentication-method=client_secret_basic
# spring.security.oauth2.client.registration.keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET}
